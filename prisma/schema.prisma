datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Type {
  pdf
  doc
  docx
  txt
  markdown
  mdx
  csv
  xls
  xlsx
  ppt
  pptx
  json
  xml
  yaml
}


model User {
    id String @id @default(cuid()) /// from clerk
    email String @unique /// from clerk
    name String /// from clerk
    image String? /// from clerk
    createdAt DateTime @default(now())
    clusters Cluster[]
    updatedAt   DateTime  @updatedAt

    links LinkUser[]
}
// todo: add category to cluster
model Cluster {
    id String @id @default(uuid())
    name String @unique
    userId String
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
    // documents Document[]
    link Link?
    createdAt DateTime @default(now())
    updatedAt   DateTime  @updatedAt
    documents ClusterDocument[]
}

model Document {
    id String @id @default(uuid())
    name String
    type Type
    url String /// from supabase
    // cluster Cluster @relation(fields: [clusterId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())
    updatedAt   DateTime  @updatedAt
    clusters ClusterDocument[]
}

// create cluster doc join table
model ClusterDocument {
  id String @id @default(uuid())
  clusterId String
  documentId String
  cluster Cluster @relation(fields: [clusterId], references: [id], onDelete: Cascade)
  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
}
 

model Link {
    id String @id @default(uuid())
    clickCount Int @default(0)
    url String
    trackingId String? @unique
    profileDescription String @default("ðŸ‘‹ Welcome to my profile! Open to connections, collaboration, and new ideas. Let's make great things happen together. ðŸŒŸ")
    backgroundColor String @default("bg-amber-50")
    clusterId String @unique
    cluster Cluster @relation(fields: [clusterId], references: [id], onDelete: Cascade)
    createdAt DateTime @default(now())
    updatedAt   DateTime  @updatedAt
    user LinkUser[]

    Clicks Clicks[]
}

model Clicks {
  id String @id @default(uuid())
  ip        String?
  country   String?
  userAgent String?
  link Link @relation(fields: [linkId], references: [id], onDelete: Cascade)
  linkId String
  createdAt DateTime  @default(now())
}

model LinkUser{
  id String @id @default(uuid())
  linkId String
  userId String
  link Link @relation(fields: [linkId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}